<!doctype html>
<html>
<head>
	<title>Exercise 2</title>
	<script src="test-2-data.js"></script>
</head>

<body>
	<script>
		var DIFFER = 1;
		var IDENTICAL = 0;
		
		// Object.prototype.foo="bar";
		
		/* Solution 2* */

		function clone(origin) {
			switch (typeof origin) {
				case 'object': 
					if (origin == null) return null;
					if (origin instanceof Array) { var destination = []; } else { var destination = {}; }
					for (var el in origin) { 
						if (origin.hasOwnProperty(el)) { destination[el] = clone(origin[el]); } 
					}
					return destination;
				case 'boolean':
				case 'number': 
				case 'string':	return origin;
				default: 	return null;
			}			
		}

		funciton genKeys(origin) {
			var keys = [];

			for (var i in origin) {
				if ( hasOwnProperty(origin[i]) ) { keys.push(i); }
			}
			return keys;
		}

		function compare(origin1, origin2) {
			if (typeof origin1 != typeof origin2) return DIFFER;
			switch (typeof origin1) {
				case 'object': 
					if (origin1 == null && origin2 == null) return IDENTICAL;

					if (origin1 instanceof Array && origin2 instanceof Array) {
						if (origin1.length != origin2.length) { return DIFFER; }

						var keys1 = genKeys(origin1); keys1.sort();
						var keys2 = genKeys(origin2); keys2.sort();
						
						if (compare(keys1, keys2) == IDENTICAL) { // вот тут при сравнении индексов мы уйдём в бесконечную рекурсию
							for (var i in origin1) {
								if (compare(origin1[i], origin2[i]) == DIFFER) { return DIFFER; }
							}
						}
						return IDENTICAL;
					} else if (origin1 instanceof Object && origin2 instanceof Object) {

						var keys1 = genKeys(origin1); keys1.sort();
						var keys2 = genKeys(origin2); keys2.sort();
						
						if (compare(keys1, keys2) == IDENTICAL) { // и здесь
							for (var j in origin1) {
								if (origin1.hasOwn.Property(j) && origin2.hasOwn.Property(j)) {
									if (compare(origin1[j], origin2[j]) == DIFFER) { return DIFFER; }
								}
							}
						}
						return IDENTICAL;
					} else { return DIFFER; }										
				case 'boolean':
				case 'number': 
				case 'string':	if (origin1 != origin2) return DIFFER;
				default: 		return IDENTICAL;
			}
		}

		var my_honest_kennel = clone(kennel_data);
		my_honest_kennel[0].dogs[0].features.honors[0].years[0] = 2003;
		
		console.log( (compare(kennel_data[1], my_honest_kennel[1])) ? 'different' : 'identical');
		console.log([ kennel_data[0].dogs[0].features.honors[0].years[0], my_honest_kennel[0].dogs[0].features.honors[0].years[0] ]);
	</script>

</body>	
</html>
